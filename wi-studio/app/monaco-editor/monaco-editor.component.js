"use strict";var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),monaco_loader_service_1=require("./monaco-loader.service"),SOURCE_ID="ngx-monaco-editor",LANGUAGE_ID="tibcomapperscript";exports.DEFAULT_EDITOR_OPTIONS={language:LANGUAGE_ID,wordSeparators:"~!@#$%^&*()-=+[{]}|;:'\",<>/?",fixedOverflowWidgets:!0};var MonacoEditorComponent=function(){function e(e){this._monacoLoader=e,this.editorOptions={},this.hoverProvider=null,this.completionProvider=null,this.valueChange=new core_1.EventEmitter,this.cursorChange=new core_1.EventEmitter,this.selectionChange=new core_1.EventEmitter,this._disposed=!1,this._value="",this._internalHoverProvider=null,this._disposables={hoverProvider:null,completionProvider:null}}return e.prototype.ngOnInit=function(){this.isEditorLoading=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.editor.getValue()},set:function(e){e=e||"",this._value=e,this.editor&&this.editor.setValue(e)},enumerable:!0,configurable:!0}),e.prototype.insert=function(e,t){var n=null;if(t)n=this.createMonacoRangeInstance(t);else{var o=this.determineRangeToInsertTo(),i=o.startLineNumber,r=o.startColumn,a=o.endLineNumber,s=o.endColumn;n=new monaco.Range(i,r,a,s)}this.insertText(e,n)},e.prototype.insertAtClientPosition=function(e,t){var n=this.editor.getTargetAtClientPoint(t.x,t.y);if(n&&n.position){var o=n.position,i=o.lineNumber,r=o.column;this.insertText(e,this.createMonacoRangeInstance({startLineNumber:i,startColumn:r,endLineNumber:i,endColumn:r}))}},e.prototype.replaceTokenAtClientPosition=function(e,t){var n=this.getRangeForTokenAtClientPosition(t);n?this.insertText(e,monaco.Range.lift(n)):this.insert(e)},e.prototype.selectTokenAtClientPosition=function(e){var t=this.getRangeForTokenAtClientPosition(e);t&&this.editor.setSelection(monaco.Selection.lift(t))},e.prototype.setCursorAtClientPosition=function(e){var t=this.editor.getTargetAtClientPoint(e.x,e.y),n=t?t.position:null;n&&!n.equals(this.editor.getPosition())&&(this.editor.setPosition(t.position),this.editor.focus())},e.prototype.changeModel=function(e,t){if(!this._disposed&&(this._value=e,this.editor)){t=t||exports.DEFAULT_EDITOR_OPTIONS.language;var n=this.editor.getModel(),o=monaco.editor.createModel(e,t);this.editor.setModel(o),n&&n.dispose()}},e.prototype.setErrors=function(e){var t=this;if(!this._disposed&&this.editor){var n=this.editor.getModel();if(n){var o=e&&e.length?e.map(function(e){return t.errorToMarker(e)}):[];monaco.editor.setModelMarkers(n,SOURCE_ID,o)}}},e.prototype.ngAfterViewInit=function(){var e=this;this._monacoLoader.load().then(function(){e._disposed||e.initMonaco()})},e.prototype.ngOnDestroy=function(){var e=this;this._disposed||(this._disposed=!0,this.editor&&(this._monacoLoader.restoreGlobals(),this.editor.dispose()),this.editor=null,Object.keys(this._disposables).forEach(function(t){var n=e._disposables[t];n&&n.dispose()}),this._internalHoverProvider&&this._internalHoverProvider.dispose(),this._internalHoverProvider=null)},e.prototype.onWindowResize=function(e){this.updateDimensions()},e.prototype.updateDimensions=function(e){this.editor&&this.editor.layout(e)},e.prototype.initMonaco=function(){var e=this,t=Object.assign({},exports.DEFAULT_EDITOR_OPTIONS,this.editorOptions,{value:this._value}),n=this.getLanguageId();monaco.languages.register({id:n}),monaco.languages.setMonarchTokensProvider(n,this.getGrammar()),this.registerHoverProvider(),this.registerCompletionProvider(),this.editor=monaco.editor.create(this.editorRef.nativeElement,t),this.editor.onDidChangeModelContent(function(){return e.onDidChangeContent()}),this.editor.onDidChangeCursorPosition(function(t){return e.onDidChangeCursorPosition(t)}),this.editor.onDidChangeCursorSelection(function(t){return e.onDidChangeCursorSelection(t)});var o=this.editor.onDidScrollChange(function(t){e.isEditorLoading=!1,o.dispose()})},e.prototype.onDidChangeContent=function(){var e=this.editor.getModel().getValue();this._value=e,this.valueChange.next(e)},e.prototype.onDidChangeCursorPosition=function(e){this.editor.getModel().getOffsetAt(e.position);this.cursorChange.next(e)},e.prototype.onDidChangeCursorSelection=function(e){var t=this.editor.getModel(),n=e.selection.getStartPosition(),o=(t.getOffsetAt(n),e.selection.getEndPosition());t.getOffsetAt(o);this.selectionChange.next(e)},e.prototype.registerHoverProvider=function(){var e=this,t=function(t,n,o){if(!e.hoverProvider)return null;var i=n.lineNumber,r=n.column,a=t.getOffsetAt(n);return Promise.resolve(e.hoverProvider.provideHover({lineNumber:i,column:r,offset:a},o)).then(function(t){var n=t.contents,o=t.range;return{contents:n,range:e.createMonacoRangeInstance(o)}})};this._disposables.hoverProvider=monaco.languages.registerHoverProvider(this.getLanguageId(),{provideHover:function(e,n,o){return t(e,n,o)}})},e.prototype.registerCompletionProvider=function(){var e=this,t=function(t,n,o){if(!e.completionProvider)return[{label:"string.concat(str1, str2, ...) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.concat(str1, str2)"},{label:"string.base64ToString(base64str) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.base64ToString(base64str)"},{label:"string.contains(str, substr) : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.contains(str, substr)"},{label:"string.dateFormat() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.dateFormat()"},{label:"string.datetimeFormat() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.datetimeFormat()"},{label:"string.endsWith(str, substr) : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.endsWith(str, substr)"},{label:"string.index(str, substr) : int",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.index(str, substr)"},{label:"string.lastIndex(str, substr) : int",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.lastIndex(str, substr)"},{label:"string.lowerCase(str) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.lowerCase(str)"},{label:"string.regex(pattern, str) : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.regex(pattern, str)"},{label:"string.split(str, sep) : string[]",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.split(str, sep)"},{label:"string.startsWith(str, substr) : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.startsWith(str, substr)"},{label:"string.length(str) : int",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.length(str)"},{label:"string.stringToBase64(str) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.stringToBase64(str)"},{label:"string.substring(string, startIndex, length) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.substring(string, startIndex, length)"},{label:"string.substring(string, startIndex) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.substring(string, startIndex)"},{label:"string.substringAfter(string, afterString) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.substringAfter(string, afterString)"},{label:"string.substringBefore(string, beforeString) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.substringBefore(string, beforeString)"},{label:"string.timeFormat() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.timeFormat()"},{label:"string.tostring(object) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.tostring(object)"},{label:"string.trim(str): string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.trim(str)"},{label:"string.upperCase(str) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"string.upperCase(str)"},{label:"number.int64(str) : int",kind:monaco.languages.CompletionItemKind.Function,insertText:"number.int64(str)"},{label:"number.len(str) : int",kind:monaco.languages.CompletionItemKind.Function,insertText:"number.len(str)"},{label:"number.random(limit) : int",kind:monaco.languages.CompletionItemKind.Function,insertText:"number.random(limit)"},{label:"boolean.true() : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"boolean.true()"},{label:"boolean.false() : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"boolean.false()"},{label:"datetime.currentDate() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.currentDate()"},{label:"datetime.currentDatetime() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.currentDatetime()"},{label:"datetime.currentTime() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.currentTime()"},{label:"datetime.formatDate(date, dateFormat) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.formatDate(date, dateFormat)"},{label:"datetime.formatDatetime(datetime, dateTimeFormat) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.formatDatetime(datetime, dateTimeFormat)"},{label:"datetime.formatTime(time, timeFormat) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.formatTime(time, timeFormat)"},{label:"datetime.now() : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"datetime.now()"},{label:"array.create(item1, item2, item3, ...) : array[]",kind:monaco.languages.CompletionItemKind.Function,insertText:"array.create(item1, item2, item3, ...)"},{label:"array.contains(array, item) : bool",kind:monaco.languages.CompletionItemKind.Function,insertText:"array.contains(array, item)"},{label:"array.forEach(sourceArray) : void",kind:monaco.languages.CompletionItemKind.Function,insertText:"array.forEach(sourceArray)"},{label:"array.forEach() : void",kind:monaco.languages.CompletionItemKind.Function,insertText:"array.forEach()"},{label:"utility.renderJSON(object, prettyFormat) : string",kind:monaco.languages.CompletionItemKind.Function,insertText:"utility.renderJSON(object, prettyFormat)"}];var i=n.lineNumber,r=n.column,a=t.getOffsetAt(n);return e.completionProvider.provideCompletionItems({lineNumber:i,column:r,offset:a},o)};this._disposables.completionProvider=monaco.languages.registerCompletionItemProvider(this.getLanguageId(),{provideCompletionItems:function(e,n,o){return t(e,n,o)}})},e.prototype.createMonacoRangeInstance=function(e){var t=this.editor.getModel();if(e&&e.startOffset){e=e;var n,o,i,r=null,a=t.getPositionAt(e.startOffset),s=t.getPositionAt(e.endOffset);return n=a.lineNumber,o=a.column,i=s.lineNumber,r=s.column,new monaco.Range(n,o,i,r)}var l=(e=e).startLineNumber,c=e.startColumn,d=e.endLineNumber,m=e.endColumn;return new monaco.Range(l,c,d,m)},e.prototype.errorToMarker=function(e){var t=this.createMonacoRangeInstance(e.location),n=t.startLineNumber,o=t.startColumn,i=t.endColumn;return{startLineNumber:n,startColumn:o,endLineNumber:t.endLineNumber,endColumn:i,severity:monaco.Severity.Error,message:e.message}},e.prototype.determineRangeToInsertTo=function(){var e=this.editor.getSelection();return{startLineNumber:e.selectionStartLineNumber,startColumn:e.selectionStartColumn,endLineNumber:e.positionLineNumber,endColumn:e.positionColumn}},e.prototype.getLanguageId=function(){return LANGUAGE_ID},e.prototype.insertText=function(e,t){this.editor.executeEdits(SOURCE_ID,[{text:e,range:t,identifier:{major:1,minor:1},forceMoveMarkers:!0}])},e.prototype.getRangeForTokenAtClientPosition=function(e){var t=this.editor.getTargetAtClientPoint(e.x,e.y);if(!t||!t.position)return null;var n=t.position,o=this.editor.getModel().getWordAtPosition(n);return o?{startLineNumber:n.lineNumber,startColumn:o.startColumn,endLineNumber:n.lineNumber,endColumn:o.endColumn}:null},e.prototype.getGrammar=function(){return{tokenPostfix:".js",keywords:["true","false"],builtins:[],operators:[],brackets:[["(",")","bracket.parenthesis"],["{","}","bracket.curly"],["[","]","bracket.square"]],symbols:/[~!@#%\^&*-+=|\\:`<>.?\/]+/,escapes:/\\(?:[btnfr\\"']|[0-7][0-7]?|[0-3][0-7]{2})/,exponent:/[eE][\-+]?[0-9]+/,regexpctl:/[(){}\[\]\$\^|\-*+?\.]/,regexpesc:/\\(?:[bBdDfnrstvwWn0\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,tokenizer:{root:[[/([a-zA-Z_\$][\w\$]*)(\s*)(:?)/,{cases:{"$1@keywords":["keyword","white","delimiter"],$3:["key.identifier","white","delimiter"],"$1@builtins":["predefined.identifier","white","delimiter"],"@default":["identifier","white","delimiter"]}}],{include:"@whitespace"},[/\/(?=([^\\\/]|\\.)+\/)/,{token:"regexp.slash",bracket:"@open",next:"@regexp"}],[/[{}()\[\]]/,"@brackets"],[/[;,.]/,"delimiter"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/\d+\.\d*(@exponent)?/,"number.float"],[/\.\d+(@exponent)?/,"number.float"],[/\d+@exponent/,"number.float"],[/0[xX][\da-fA-F]+/,"number.hex"],[/0[0-7]+/,"number.octal"],[/\d+/,"number"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string",'@string."'],[/'/,"string","@string.'"]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\/\*/,"comment.invalid"],["\\*/","comment","@pop"],[/[\/*]/,"comment"]],string:[[/[^\\"']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/["']/,{cases:{"$#==$S2":{token:"string",next:"@pop"},"@default":"string"}}]],regexp:[[/(\{)(\d+(?:,\d*)?)(\})/,["@brackets.regexp.escape.control","regexp.escape.control","@brackets.regexp.escape.control"]],[/(\[)(\^?)(?=(?:[^\]\\\/]|\\.)+)/,["@brackets.regexp.escape.control",{token:"regexp.escape.control",next:"@regexrange"}]],[/(\()(\?:|\?=|\?!)/,["@brackets.regexp.escape.control","regexp.escape.control"]],[/[()]/,"@brackets.regexp.escape.control"],[/@regexpctl/,"regexp.escape.control"],[/[^\\\/]/,"regexp"],[/@regexpesc/,"regexp.escape"],[/\\\./,"regexp.invalid"],["/",{token:"regexp.slash",bracket:"@close"},"@pop"]],regexrange:[[/-/,"regexp.escape.control"],[/\^/,"regexp.invalid"],[/@regexpesc/,"regexp.escape"],[/[^\]]/,"regexp"],[/\]/,"@brackets.regexp.escape.control","@pop"]]}}},e}();__decorate([core_1.ViewChild("editor"),__metadata("design:type",core_1.ElementRef)],MonacoEditorComponent.prototype,"editorRef",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],MonacoEditorComponent.prototype,"editorOptions",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],MonacoEditorComponent.prototype,"hoverProvider",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],MonacoEditorComponent.prototype,"completionProvider",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MonacoEditorComponent.prototype,"valueChange",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MonacoEditorComponent.prototype,"cursorChange",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MonacoEditorComponent.prototype,"selectionChange",void 0),__decorate([core_1.Input(),__metadata("design:type",String),__metadata("design:paramtypes",[String])],MonacoEditorComponent.prototype,"value",null),__decorate([core_1.HostListener("window:resize",["event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[MouseEvent]),__metadata("design:returntype",void 0)],MonacoEditorComponent.prototype,"onWindowResize",null),MonacoEditorComponent=__decorate([core_1.Component({selector:"monaco-editor",styleUrls:["monaco-editor.component.css"],template:'\n    <div #editor class="editor-container" [style.width]="\'100%\'" [style.height]="\'100%\'" ></div>\n    <div class="editor-spinner" *ngIf="isEditorLoading">\n    <div class="editor-spinner__indicator">\n      <svg viewBox="0 0 64 64"><g stroke-width="0">\n       <circle cx="24" cy="0" transform="translate(32,32)" r="6.93333">\n        <animate attributeName="r" dur="750ms" values="8;7;6;5;4;3;2;1;8" repeatCount="indefinite"></animate>\n       </circle>\n       <circle cx="16.970562748477143" cy="16.97056274847714" transform="translate(32,32)" r="7.93333">\n        <animate attributeName="r" dur="750ms" values="1;8;7;6;5;4;3;2;1" repeatCount="indefinite"></animate>\n       </circle>\n       <circle cx="1.4695761589768238e-15" cy="24" transform="translate(32,32)" r="1.46666">\n        <animate attributeName="r" dur="750ms" values="2;1;8;7;6;5;4;3;2" repeatCount="indefinite"></animate>\n       </circle>\n       <circle cx="-16.97056274847714" cy="16.970562748477143" transform="translate(32,32)" r="1.93333">\n        <animate attributeName="r" dur="750ms" values="3;2;1;8;7;6;5;4;3" repeatCount="indefinite"></animate>\n       </circle><circle cx="-24" cy="2.9391523179536475e-15" transform="translate(32,32)" r="2.93333">\n        <animate attributeName="r" dur="750ms" values="4;3;2;1;8;7;6;5;4" repeatCount="indefinite"></animate>\n       </circle>\n       <circle cx="-16.970562748477143" cy="-16.97056274847714" transform="translate(32,32)" r="3.93333">\n        <animate attributeName="r" dur="750ms" values="5;4;3;2;1;8;7;6;5" repeatCount="indefinite"></animate>\n       </circle><circle cx="-4.408728476930472e-15" cy="-24" transform="translate(32,32)" r="4.93333">\n        <animate attributeName="r" dur="750ms" values="6;5;4;3;2;1;8;7;6" repeatCount="indefinite"></animate>\n       </circle><circle cx="16.970562748477136" cy="-16.970562748477143" transform="translate(32,32)" r="5.93333">\n       <animate attributeName="r" dur="750ms" values="7;6;5;4;3;2;1;8;7" repeatCount="indefinite"></animate>\n       </circle></g></svg>\n      </div>\n     </div>\n  '}),__metadata("design:paramtypes",[monaco_loader_service_1.MonacoLoaderService])],MonacoEditorComponent),exports.MonacoEditorComponent=MonacoEditorComponent;