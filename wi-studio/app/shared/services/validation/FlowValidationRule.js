"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_extensions_1=require("../../../../common/rxjs-extensions"),validation_1=require("../../../../common/models/validation"),validationrule_1=require("../../../../common/models/vrules/validationrule"),validation_2=require("../../../../common/models/validation"),constants_1=require("../../../../common/constants"),lodash=require("lodash"),FlowHook=function(){function t(t,e){this.appContext=t,this.flowContext=e}return t.prototype.hook=function(t){var e=this;rxjs_extensions_1.Observable.from(t.getErrors()).map(function(t){var n=new Map;n.set("APPNAME",e.appContext.applicationName),n.set("APPID",e.appContext.id),n.set("FLOWNAME",e.flowContext.name),n.set("FLOWID",e.flowContext._id),t.setContext(n)}).subscribe(function(t){})},t}();exports.FlowHook=FlowHook;var FlowValidationRule=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.newValidationRule=function(){return new e},e.prototype.getContribHook=function(t){return new FlowHook(t.getElements(constants_1.EnumValidationContext.APPLICATION),t.getElements(constants_1.EnumValidationContext.FLOW))},e.prototype.getContexts=function(t){var e=t.getElements(constants_1.EnumValidationContext.APPLICATION),n=[];for(var o in e.flows){var a=e.flows[o];n.push(lodash.cloneDeep(t)),n[n.length-1].addElement(constants_1.EnumValidationContext.FLOW,a)}return n},e.prototype.canValidate=function(t){return!0},e.prototype.validate=function(t){return rxjs_extensions_1.Observable.create(function(e){var n=validation_2.ValidationResult.newValidationResult(),o=t.getElements(constants_1.EnumValidationContext.FLOW);for(var a in o.paths.nodes)if(o.paths.nodes[a].taskID&&o.items[o.paths.nodes[a].taskID]&&"tibco-wi-reply"===o.items[o.paths.nodes[a].taskID].name){var i=void 0;for(i=0;i<o.paths.nodes[a].children.length;i++){var r=o.paths.nodes[a].children[i];if(o.paths.nodes[r].taskID&&o.items[o.paths.nodes[r].taskID]&&"tibco-wi-reply"===o.items[o.paths.nodes[r].taskID].name){n.setValid(!1),n.errors.push(validation_1.ValidationError.newError("500","Error: There are consecutive reply activites in flow "+o.name));break}}if(i!==o.paths.nodes[a].children.length)break}e.next(n),e.complete()})},e}(validationrule_1.AbstractValidationRule);exports.FlowValidationRule=FlowValidationRule;