"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_extensions_1=require("../../../../common/rxjs-extensions"),validation_1=require("../../../../common/models/validation"),validationrule_1=require("../../../../common/models/vrules/validationrule"),validation_2=require("../../../../common/models/validation"),constants_1=require("../../../../common/constants"),RestValidationRule=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.newValidationRule=function(){return new e},e.prototype.getContribHook=function(t){return null},e.prototype.canValidate=function(t){var e=t.getElements(constants_1.EnumValidationContext.APPLICATION).flows;for(var n in e)if(n){var o=e[n].paths.root.is,r=e[n].paths.nodes[o].taskID;if("tibco-wi-rest"===e[n].items[r].name)return!0}return!1},e.prototype.getContexts=function(t){return[t]},e.prototype.validate=function(t){var e=this;return rxjs_extensions_1.Observable.create(function(n){for(var o=e.extractMethodAndPath(t.getElements(constants_1.EnumValidationContext.APPLICATION)),r=validation_2.ValidationResult.newValidationResult(),i=0;i<o.length;i++){for(var a=i+1;a<o.length;a++)o[i].method===o[a].method&&o[i].path===o[a].path&&(r.setValid(!1),r.errors.push(validation_1.ValidationError.newError("500","Error: "+o[i].flowName+" and "+o[a].flowName+" have the same method and path")));o[i].replyActivity||(r.setValid(!1),r.errors.push(validation_1.ValidationError.newError("500","Error: "+o[i].flowName+" has REST trigger but reply activity is missing")))}n.next(r),n.complete()})},e.prototype.extractMethodAndPath=function(t){var e=t.flows,n=[];for(var o in e)if(o){var r=e[o].paths.root.is,i=e[o].paths.nodes[r].taskID,a=e[o].items[i];if("tibco-wi-rest"===a.name){var s={};s.flowName=e[o].name;for(var l=0;l<a.handler.settings.length;l++)"method"===a.handler.settings[l].name.toLowerCase()?s.method=a.handler.settings[l].value:"path"===a.handler.settings[l].name.toLowerCase()&&(s.path=a.handler.settings[l].value);s.replyActivity=this.checkForReplyActivity(e[o]),n.push(s)}}return n},e.prototype.checkForReplyActivity=function(t){for(var e in t.items)if(e&&"tibco-wi-reply"===t.items[e].name)return!0;return!1},e}(validationrule_1.AbstractValidationRule);exports.RestValidationRule=RestValidationRule;