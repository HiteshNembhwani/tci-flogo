"use strict";var __decorate=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}};Object.defineProperty(exports,"__esModule",{value:!0});var wi_contrib_service_1=require("../../contrib/wi-contrib.service"),validationrule_1=require("../../../common/models/vrules/validationrule"),serviceurls_1=require("./../serviceurls"),rxjs_extensions_1=require("../../../common/rxjs-extensions"),http_1=require("@angular/http"),core_1=require("@angular/core"),messaging_1=require("../../../common/services/messaging"),validation_service_1=require("./validation/validation.service"),lodash=require("lodash"),constants_1=require("../../../common/constants"),flow_service_1=require("../../../common/services/flow.service"),FlowService=function(){function e(e,t,r){var i=this;this.validationService=e,this.http=t,this.contribService=r,this._msg=new messaging_1.AppMessaging({}),this._msg.getObservable("SAVE_APP_MODEL").subscribe(function(e){i.postApp(e).subscribe(function(e){return e},function(e){})},function(e){})}return e.prototype.saveApp=function(e,t){var r={};r.app=e,r.skipValidations=t,this._msg.emit("SAVE_APP_MODEL",r)},e.prototype.getAppDetails=function(e){return this.http.get(serviceurls_1.SERVICE_URLS.APP+e).map(function(e){return e.json()}).catch(this.handleServerError)},e.prototype.getConfiguration=function(){return this.http.get(serviceurls_1.SERVICE_URLS.CONFIG).map(function(e){return e.json()}).catch(this.handleServerError)},e.prototype.postApp=function(e){if(!0!==e.skipValidations){var t=validationrule_1.ValidationContext.newContext();t.addElement(constants_1.EnumValidationContext.APPLICATION,lodash.cloneDeep(e.app)),this.validationService.start(t,this.contribService).subscribe(function(e){})}return flow_service_1.CUIApp.uiModelToRtModel(e.app),this.http.put(serviceurls_1.SERVICE_URLS.APP+e.app.id,e.app).map(function(e){return e.json()}).catch(this.handleServerError)},e.prototype.handleServerError=function(e){return rxjs_extensions_1.Observable.throw(e||"Server error")},e}();FlowService=__decorate([core_1.Injectable(),__param(0,core_1.Inject(validation_service_1.ValidationService)),__param(1,core_1.Inject(http_1.Http)),__metadata("design:paramtypes",[Object,http_1.Http,wi_contrib_service_1.ContribService])],FlowService),exports.FlowService=FlowService;