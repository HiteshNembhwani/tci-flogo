"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__decorate=this&&this.__decorate||function(t,e,n,r){var o,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(a=(s<3?o(a):s>3?o(e,n,a):o(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),rxjs_extensions_1=require("../../../common/rxjs-extensions"),http_1=require("@angular/http"),XHRStreamConnection=function(){return function(t,e,n){var r=this;this.req=t,this.request=t,this.chunks=rxjs_extensions_1.Observable.create(function(n){var o=e.build(),s=0,a=function(t){var e=o.responseText;e=e.substring(s),n.next({data:e}),s+=e.length};return o.addEventListener("progress",a),o.open(http_1.RequestMethod[t.method].toUpperCase(),t.url),o.send(r.request.getBody()),function(){o.removeEventListener("progress",a),o.abort()}})}}();exports.XHRStreamConnection=XHRStreamConnection;var XHRStreamBackEnd=function(){function t(t,e,n){this._browserXHR=t,this._baseResponseOptions=e,this._xsrfStrategy=n}return t.prototype.createConnection=function(t){return this._xsrfStrategy.configureRequest(t),new XHRStreamConnection(t,this._browserXHR,this._baseResponseOptions)},t}();XHRStreamBackEnd=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.BrowserXhr,http_1.ResponseOptions,http_1.XSRFStrategy])],XHRStreamBackEnd),exports.XHRStreamBackEnd=XHRStreamBackEnd;var XHRStreamHttp=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.backend=e,r.defaultOptions=n,r}return __extends(e,t),e.prototype.getChunks=function(t,e){return this.backend.createConnection(new http_1.Request(this.mergeOptions(this.defaultOptions,e,http_1.RequestMethod.Get,t))).chunks},e.prototype.uploadContribution=function(t,e){return this.backend.createConnection(new http_1.Request(this.mergeOptions(this.defaultOptions,e,http_1.RequestMethod.Post,t))).chunks},e.prototype.mergeOptions=function(t,e,n,r){var o=t;return this.isPresent(e)?o.merge(new http_1.RequestOptions({method:e.method||n,url:e.url||r,search:e.search,headers:e.headers,body:e.body,withCredentials:e.withCredentials,responseType:e.responseType})):this.isPresent(n)?o.merge(new http_1.RequestOptions({method:n,url:r})):o.merge(new http_1.RequestOptions({url:r}))},e.prototype.isPresent=function(t){return void 0!==t&&null!==t},e}(http_1.Http);XHRStreamHttp=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[XHRStreamBackEnd,http_1.RequestOptions])],XHRStreamHttp),exports.XHRStreamHttp=XHRStreamHttp;