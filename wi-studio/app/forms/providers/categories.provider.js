"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var constants_1=require("../../../common/constants"),lodash=require("lodash");exports.DEFCATS={configuration:{title:"Configuration"},input_settings:{title:"Input Settings"},input:{title:"Input"},output_settings:{title:"Output Settings"},output:{title:"Output"}};var CategoriesProvider=function(){function t(t){var e=this;this.task=t,this.categories=[],this.categoriesTitles=[],lodash.forEach(exports.DEFCATS,function(t){e.categories.push(new FormCategory({title:t.title})),e.categoriesTitles.push(t.title)});var i=this;for(var s in this.task)!function(t){if((lodash.isArray(i.task[t])||"handler"===t)&&!lodash.isEmpty(i.task[t])){var s=i.task[t];"handler"===t?s=i.task.handler.settings:t.indexOf("input")>=0||"Output Settings"===t||t.indexOf("output"),s.forEach(function(i){e.identifySections(i,t).forEach(function(s){return e.addFieldToCategory(s,i,t)})})}}(s)}return t.prototype.addFieldToCategory=function(t,e,i){var s={source:t,field:e};this.getCategoryByTitle(t).addField(s).setDirection(i)},t.prototype.getCategoryByTitle=function(t){var e=this.categories.filter(function(e){return e.title===t});return e.length>0?e.pop():void 0},t.prototype.identifySections=function(t,e){var i=[];if(t.display)if(t.display.section||this.categoriesTitles.includes(t.display.section))this.getCategoryByTitle(t.display.section)?i.push(t.display.section):constants_1.FLOW_DIAGRAM_DEBUG;else{var s=!1;"inputs"===e||"handler"===e?(t.display.schema||t.display.mappable?lodash.get(t,"display.readonly",!1)||(i.push("Input Settings"),s=!0):(i.push("Configuration"),s=!0),t.display.mappable&&(i.push("Input"),s=!0),s||constants_1.FLOW_DIAGRAM_DEBUG):"output"===e?i.push("Output Settings"):"outputs"===e?(i.push("Output Settings"),i.push("Output")):constants_1.FLOW_DIAGRAM_DEBUG}else t.display?constants_1.FLOW_DIAGRAM_DEBUG:"inputs"===e||"handler"===e?i.push("Input"):"outputs"===e?"complex_object"===t.type?i.push("Output Settings"):t.display?constants_1.FLOW_DIAGRAM_DEBUG:i.push("Output"):constants_1.FLOW_DIAGRAM_DEBUG;return i},t}();exports.CategoriesProvider=CategoriesProvider;var FormCategory=function(){function t(t){this.title=t.title,this.direction=t.direction||null,this.fields=t.fields||[]}return Object.defineProperty(t.prototype,"visible",{get:function(){return this.fields.filter(function(t){return lodash.get(t.field,"display.visible",!0)}).length>0},enumerable:!0,configurable:!0}),t.prototype.setDirection=function(t){return this.direction=t,this},t.prototype.addField=function(t){return this.fields.map(function(t){return t.field.name}).includes(t.field.name)||this.fields.push(t),this},t}();exports.FormCategory=FormCategory;