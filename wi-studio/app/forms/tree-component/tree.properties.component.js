"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var json_tree_1=require("../../wi.primeng/tree/json.tree"),core_1=require("@angular/core"),schema=require("generate-schema"),contributionHelper_1=require("../../../common/util/contributionHelper"),lodash=require("lodash"),_trees=[],TreePropertiesComponent=function(){function e(){this.errorsFound=!1,this.trees=[]}return e.prototype.ngOnInit=function(){this.getTreesModel()},e.prototype.getTreesModel=function(){this.trees=[];for(var e=this.task&&this.task.outputs?this.task.outputs:[],t=0,r=this.getTreesIOProperties(e);t<r.length;t++){var o=r[t],i=new json_tree_1.JsonTree(o);if(!o.title||"schema"!==o.title&&"any"!==o.title)this.trees.push(i);else for(var n=0,s=i.children;n<s.length;n++){var a=s[n];this.trees.push(a)}}},e.prototype.getTreesIOProperties=function(e){var t,r=[];if(e)for(var o=0,i=e;o<i.length;o++){var n=i[o];if((!n.display||n.display&&(void 0===n.display.visible||n.display.visible))&&(t=this.isComplexObject(n)?this.getTreeValue(n):this.getTreeRegularValue(n),this.addPropertyTree(r,t,n),this.ioItemToMatch&&this.matchToCurrentIOItem(n)))break}return r},e.prototype.addPropertyTree=function(e,t,r){try{if(t&&t.tree&&""!==t.tree){var o=JSON.parse(t.tree),i=void 0;switch(lodash.get(r,"display.type","").toLowerCase()){case"params":i=JSON.parse(contributionHelper_1.ContributionHelper.jsonToSchema(o));break;case"texteditor":i=schema.json(o);break;default:(i=o).type=r.type}i.title=r.name,e.push(i)}}catch(e){this.errorsFound=!0}},e.prototype.getTreeValue=function(e){var t="",r="";return e.value&&e.type&&(t=void 0!==e.value.value?e.value.value:e.value,r=e.type),{tree:t,type:r}},e.prototype.getTreeRegularValue=function(e){var t="",r={};return r[e.name]=e.type,t=JSON.stringify(r),{tree:t,type:"any",propertyName:e.name,propertyType:e.type}},e.prototype.isComplexObject=function(e){return"complex_object"===e.type},e.prototype.matchToCurrentIOItem=function(e){return this.ioItemToMatch&&this.ioItemToMatch.name===e.name&&this.ioItemToMatch.type===e.type},e.prototype.isJson=function(e){return!e.type||!e.properties&&!e.items},e}();__decorate([core_1.Input(),__metadata("design:type",Object)],TreePropertiesComponent.prototype,"task",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],TreePropertiesComponent.prototype,"ioItemToMatch",void 0),TreePropertiesComponent=__decorate([core_1.Component({selector:"tree-properties",template:'\n    <wi-tree *ngIf="!errorsFound" [treeValue]="trees"></wi-tree>\n    <div class="alert alert-danger" *ngIf="errorsFound">There are errors in schema specifications. Please review.</div>\n  ',moduleId:module.id,styleUrls:["./tree.properties.component.css"],encapsulation:core_1.ViewEncapsulation.None})],TreePropertiesComponent),exports.TreePropertiesComponent=TreePropertiesComponent;