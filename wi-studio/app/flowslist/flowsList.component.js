"use strict";var __decorate=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var app_model_1=require("../../common/models/app/app.model"),flowsList_service_1=require("./flowsList.service"),core_1=require("@angular/core"),router_1=require("@angular/router"),common_1=require("@angular/common"),ng2_bootstrap_1=require("ng2-bootstrap"),angular2_notifications_1=require("angular2-notifications"),FlowsListComponent=function(){function t(t,e,o,i){this._router=t,this.flowListService=e,this._notifService=i,this.pushed=new core_1.EventEmitter,this.options={position:["bottom","right"],timeOut:5e3,lastOnBottom:!0,maxStack:3,preventDuplicates:!0},this.flows=[],this.location=o}return t.prototype.ngOnInit=function(){this.getAppData()},t.prototype.ngAfterViewInit=function(){this.currentFlow={flowId:null,index:null},this.deleteConfirmModal.config={ignoreBackdropClick:!0,keyboard:!1}},t.prototype.getAppData=function(t){var e=this;this.flows=[];var o=this.app.appId;t&&(o="PUSHVERSION:"+this.app.appId),this.flowListService.getFlowsList(o).subscribe(function(o){t&&(o.id=o.id.replace("PUSHVERSION:","")),e.appData=new app_model_1.AppModel(o);for(var i in o.flows)e.flows.push(o.flows[i]);t&&e.flowListService.putApp(e.appData).subscribe(function(t){},e.diagramTransactionsErroHandler)},this.diagramTransactionsErroHandler)},t.prototype.getTriggerTypeIcon=function(t){var e=t.paths.root.is,o=t.paths.nodes[e].taskID;return t.items[o].name},t.prototype.openFlow=function(t){this._router.navigate(["/wistudio/flow/",this.app.sandboxId,this.app.appId,t])},t.prototype.createFlow=function(){this._router.navigate(["/wistudio/create-flow/",this.app.sandboxId,this.app.appId])},t.prototype.deleteFlow=function(){this.appData.appChanges++,this.appData.deleteFLow(this.currentFlow.flowId),this.flows.splice(this.currentFlow.index,1),this.flowListService.putApp(this.appData).subscribe(function(t){},this.diagramTransactionsErroHandler),this.deleteConfirmModal.hide(),this.currentFlow.flowId=null,this.currentFlow.index=null},t.prototype.deleteFlowConfirm=function(t,e){this.currentFlow.flowId=t,this.currentFlow.index=e,this.deleteConfirmModal.show()},t.prototype.closeModalConfirm=function(){this.currentFlow.flowId=null,this.currentFlow.index=null,this.deleteConfirmModal.hide()},t.prototype.pushApp=function(){var t=this;this.flowListService.pushApp(this.appData).subscribe(function(e){void 0!==e.id?t.flowListService.getMetaData(e.id).subscribe(function(e){if(void 0!==e.manifest){t.app.vpnConnectionName&&(e.manifest.vpnConnectionName=t.app.vpnConnectionName);var o={manifestFile:e.manifest,applicationFile:e.appJson};t.diagramLaunchTCI(o)}else t.diagramTransactionsErroHandler({stack:"Metadata malformed"})},t.diagramTransactionsErroHandler):t.diagramTransactionsErroHandler({stack:"Unidentified response"})},this.diagramTransactionsErroHandler)},t.prototype.revertApp=function(){this.getAppData(!0)},t.prototype.diagramTransactionsErroHandler=function(t){},t.prototype.ExtractSandboxIdFromUrl=function(t){t=t.split("&");for(var e=0;e<t.length;e++)if(t[e].indexOf("sandboxId")>-1)return t[e].split("=")[1];return""},t.prototype.diagramLaunchTCI=function(t){var e=this,o=this.ExtractSandboxIdFromUrl(window.location.search);o&&(t.sandboxId=o,window.ng1Services.ApplicationService.pushApp(t).then(function(t){e.pushed.emit()},function(t){e._notifService.error("Error",t.data.errorDetail)}))},t}();__decorate([core_1.ViewChild("deleteConfirmModal"),__metadata("design:type",ng2_bootstrap_1.ModalDirective)],FlowsListComponent.prototype,"deleteConfirmModal",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],FlowsListComponent.prototype,"app",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],FlowsListComponent.prototype,"pushed",void 0),FlowsListComponent=__decorate([core_1.Component({selector:"flows-list",moduleId:module.id,templateUrl:"flowsList.component.html",styleUrls:["less/flowsList.css"],providers:[common_1.Location,{provide:common_1.LocationStrategy,useClass:common_1.PathLocationStrategy}]}),__metadata("design:paramtypes",[router_1.Router,flowsList_service_1.FlowsListService,common_1.Location,angular2_notifications_1.NotificationsService])],FlowsListComponent),exports.FlowsListComponent=FlowsListComponent;