"use strict";var __decorate=this&&this.__decorate||function(e,n,t,i){var o,c=arguments.length,s=c<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,n,t,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(s=(c<3?o(s):c>3?o(n,t,s):o(n,t))||s);return c>3&&s&&Object.defineProperty(n,t,s),s},__metadata=this&&this.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};Object.defineProperty(exports,"__esModule",{value:!0});var connectionsService_1=require("./../shared/services/connectionsService"),core_1=require("@angular/core"),core_2=require("@angular/core"),windowRefService_1=require("../shared/services/windowRefService"),router_1=require("@angular/router"),salesforceoAuth_1=require("../shared/services/salesforceoAuth"),ng2_bootstrap_1=require("ng2-bootstrap"),ConnectionsListComponent=function(){function e(e,n,t,i,o){var c=this;this.connectionService=e,this._window=n,this._router=t,this._activatedRoute=i,this.salesforceoAuthService=o,this.redirectedToAddNewConnection=!1,this.description="",this.appUsingThisConnection=[],this.connectionErrors="",this.activeConnectionUsedinApps=!1,this.baseLocationhRef="",this.sfIconUrl="",this.marketoIconUrl="",this.baseLocationhRef=System.baseURL,this._window.nativeWindow.location.search.indexOf("error")>0&&(this.connectionErrors=decodeURI(this._window.nativeWindow.location.search.split("error=")[1])),this.connectionService.getConnections().subscribe(function(e){if(c.connections=e,void 0!==c.connections)for(var n=0,t=c.connections;n<t.length;n++){var i=t[n];"undefined"!==i.description&&(i.description=i.description.split("+").join(" ")),i.name=i.name.split("+").join(" ")}})}return e.prototype.ngOnInit=function(){var e=this;this.connectionService.getConnections().subscribe(function(n){e.connections=n,e.activeConnection=e.connections[0],void 0!==e.activeConnection&&(e.userName=e.activeConnection.name.split("+").join(" "),"undefined"!==e.activeConnection.description&&(e.description=e.activeConnection.description.split("+").join(" ")),e.connectionID=e.activeConnection.id,e.connectionType=e.activeConnection.category,void 0!==e.activeConnection.credential&&(e.api_version=e.activeConnection.credential.api_version,e.identityURL=e.activeConnection.credential.token_endpoint,e.clientID=e.activeConnection.credential.client_id,e.clientSecret=e.activeConnection.credential.client_secret,e.endpointURL=e.activeConnection.credential.url))})},e.prototype.ngAfterViewInit=function(){void 0!==this.deleteConnectionsConfirmation&&(this.deleteConnectionsConfirmation.config={ignoreBackdropClick:!0,keyboard:!1})},e.prototype.getConnectionCredentials=function(e,n){this.connectionType=e,this.activeConnection=n,void 0!==this.activeConnection&&(this.userName=this.activeConnection.name,"undefined"!==this.activeConnection.description&&(this.description=this.activeConnection.description.split("+").join(" ")),this.userName=this.activeConnection.name.split("+").join(" "),this.connectionID=this.activeConnection.id,void 0!==this.activeConnection.credential&&(this.api_version=this.activeConnection.credential.api_version,this.identityURL=this.activeConnection.credential.token_endpoint,this.clientID=this.activeConnection.credential.client_id,this.clientSecret=this.activeConnection.credential.client_secret,this.endpointURL=this.activeConnection.credential.url))},e.prototype.getClassNameByConnectionType=function(e){return"SALESFORCE"===e&&(this.className="addConnection-bg-salesforce",this.connectionDisplayString="SF",this.fontName="addConnection-font-salesforce"),"MARKETO"===e&&(this.className="addConnection-bg-marketo",this.connectionDisplayString="M",this.fontName="addConnection-font-salesforce"),this.className},e.prototype.redirectToAddNewConnection=function(){this.redirectedToAddNewConnection=!0},e.prototype.confirmConnectionsDelete=function(e,n){this.activeConnectionId=e,this.activeConnectionType=n;var t=0;void 0!==this.activeConnection.appRefs&&(t=this.activeConnection.appRefs.length),0===t?(this.activeConnectionUsedinApps=!1,this.headerDeleteConnection="Delete this connection?"):(this.activeConnectionUsedinApps=!0,this.headerDeleteConnection="Cannot delete this connection!"),this.deleteConnectionsConfirmation.show()},e.prototype.closeDeleteConnectionsModal=function(){this.deleteConnectionsConfirmation.hide()},e.prototype.deleteConnection=function(e,n){var t=this;this.salesforceoAuthService.deleteConnectionData(e).subscribe(function(e){e.json();t.connectionService.getConnections().subscribe(function(e){t.connections=e,t.activeConnection=e[0],t.connectionType=t.activeConnection.category,void 0!==t.activeConnection&&(t.userName=t.activeConnection.name.split("+").join(" "),"undefined"!==t.activeConnection.description&&(t.description=t.activeConnection.description.split("+").join(" ")),t.connectionID=t.activeConnection.id,void 0!==t.activeConnection.credential&&(t.api_version=t.activeConnection.credential.api_version,t.identityURL=t.activeConnection.credential.url,t.clientID=t.activeConnection.credential.client_id,t.clientSecret=t.activeConnection.credential.client_secret))})},function(e){}),this.deleteConnectionsConfirmation.hide()},e.prototype.editConnection=function(e,n){this._router.navigate(["../wistudio/connectiondetails"],{queryParams:{id:e,type:n}})},e.prototype.clearConnectionError=function(){this.connectionErrors="",this._router.navigate(["../wistudio/connections"])},e.prototype.getConnectionSelectedClass=function(e){return e===this.connectionID?"connections-selectedConnection":""},e.prototype.getConnectorIconSrc=function(e){var n="";return"SALESFORCE"===e&&(n="wistudio/v1/contributions/connectors/tibco-salesforce/icons/ic-tibco-salesforce.svg"),"MARKETO"===e&&(n="wistudio/v1/contributions/connectors/tibco-marketo/icons/ic-tibco-marketo.svg"),this.baseLocationhRef+n},e}();__decorate([core_1.ViewChild("deleteConnectionsConfirmation"),__metadata("design:type",ng2_bootstrap_1.ModalDirective)],ConnectionsListComponent.prototype,"deleteConnectionsConfirmation",void 0),ConnectionsListComponent=__decorate([core_1.Component({moduleId:module.id,selector:"wi-app",templateUrl:"connections-list.html",styleUrls:["connections-list.css"],encapsulation:core_2.ViewEncapsulation.Emulated}),__metadata("design:paramtypes",[connectionsService_1.ConnectionsService,windowRefService_1.WindowRef,router_1.Router,router_1.ActivatedRoute,salesforceoAuth_1.SalesforceoAuthService])],ConnectionsListComponent),exports.ConnectionsListComponent=ConnectionsListComponent;